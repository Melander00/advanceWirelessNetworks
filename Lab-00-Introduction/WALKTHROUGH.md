# Lab-00 – End-to-End Walkthrough (ns-3.40 + NetAnim)

> **You can complete Lab-00 entirely inside Docker** (compile/run, produce anim XML).
> **But NetAnim is a GUI app**; we recommend installing/running it **natively on your host** (Linux/macOS/Windows-WSL with X) and just opening the XML generated by your container run. NetAnim is a standalone Qt5 GUI that consumes trace XML generated by ns-3’s `AnimationInterface`.

---

## 0) One-time: build the container (ns-3.40 frozen)

From your repo root:

```bash
make docker-build
```

* Builds the pinned Ubuntu 22.04 image and compiles **ns-3.40** with Python bindings (cppyy).
* Image name (default): `ns3-3.40:latest`.

Smoke test (optional):

```bash
make check
```

* Runs `scripts/ci_smoke.sh` inside the image to verify Python `ns` imports, a tutorial echo example, and a minimal simulation.

---

## 1) Enter the container and set env

```bash
make shell
# inside the container now:
source scripts/setup_env.sh
```

* `make shell` starts a container with the repo bind-mounted at `/work`.
* `setup_env.sh` exports `NS3_DIR` and puts ns-3 Python/C++ bits on your PATH/PYTHONPATH. You should see “Python ‘ns’ import: OK”.

---

## 2) Lab-00 (Python path): run & capture output

### 2.1 Create submission folder (once)

```bash
mkdir -p /work/Lab-00-Introduction/submission
```

### 2.2 Run the Python hello

```bash
python3 /work/Lab-00-Introduction/code/Lab0_Py_Hello.py > /work/Lab-00-Introduction/submission/hello_py_output.txt
```

* Captures stdout to `hello_py_output.txt` (required in deliverables).

> If you ever see `ModuleNotFoundError: No module named 'ns.core'`, you’re using an old import idiom. Use `from ns import ns` with cppyy.
> If you see scheduling errors with Python callables, prefer the provided Lab-00 file (already fixed) or schedule via a tiny C++ shim/event (cppyy limitation).

---

## 3) Lab-00 (C++ path): run & capture output

### 3.1 Build once (after copying to scratch)

```bash
cp /work/Lab-00-Introduction/code/Lab0_Cpp_Hello.cc "$NS3_DIR/scratch/"
cd "$NS3_DIR"
./ns3 build
```

* This configures/builds ns-3 and compiles your `scratch/Lab0_Cpp_Hello.cc`.

### 3.2 Run it and save output

```bash
./ns3 run scratch/Lab0_Cpp_Hello > /work/Lab-00-Introduction/submission/hello_cpp_output.txt
```

* Expected content: “Hello Simulator”.

---

## 4) Generate a NetAnim XML (C++)

Lab-00 also expects you to produce a **NetAnim XML** and open it in the GUI. Use the tiny C++ anim example (already in the repo) to emit `lab0_cpp_anim.xml`.

### 4.1 Build & run the anim example

```bash
# copy example to scratch if not already
cp /work/Lab-00-Introduction/code/Lab0_Cpp_Anim.cc "$NS3_DIR/scratch/"

cd "$NS3_DIR"
./ns3 build
./ns3 run "scratch/Lab0_Cpp_Anim --animFile=/work/Lab-00-Introduction/submission/lab0_cpp_anim.xml"
```

* The program uses ns-3’s **AnimationInterface** to write the XML.
* Result lands **in your repo**: `Lab-00-Introduction/submission/lab0_cpp_anim.xml`.

(If the program didn’t take `--animFile`, hardcode the output path or move the default output into `/work/Lab-00-Introduction/submission/`.)

---

## 5) Install & run NetAnim **natively** (host machine)

> NetAnim is a standalone Qt5 app. You build it with `qmake` + `make`, then run `./NetAnim` and open the XML file. Official wiki: “NetAnim 3.108”.

### 5.1 Why native (not Docker)?

* It’s a **GUI**. Running it in Docker needs X11 or Wayland forwarding, which is messy across OSes.
* Qt GUI dependencies bloat the image and complicate CI.
* Upstream guidance: NetAnim is an external GUI consuming `AnimationInterface` traces; there’s no requirement it run in the same environment as your simulation.

### 5.2 Get NetAnim sources (version 3.108)

Option A (official archive index):

```bash
# Linux host (Ubuntu/Debian shown)
mkdir -p ~/netanim && cd ~/netanim
curl -LO https://www.nsnam.org/tools/netanim/netanim-3.108.tar.bz2
tar xjf netanim-3.108.tar.bz2
cd netanim-3.108
```

(3.108 is published on nsnam.org under /tools/netanim.)

Option B (historic Mercurial tag with 3.108 release notes):
The 3.108 changeset is recorded here (for reference).

> You also shared a direct snapshot link; if you use that ZIP instead, just unzip and `cd` into the extracted folder.

### 5.3 Install prerequisites (Ubuntu/Debian)

```bash
sudo apt-get update
sudo apt-get install -y qtbase5-dev qttools5-dev-tools build-essential
```

* The wiki lists Qt5 as the requirement (qmake build).

### 5.4 Build NetAnim

```bash
# inside the netanim-3.108 directory
qmake NetAnim.pro
make -j"$(nproc)"
```

* Produces an executable named `NetAnim` in the same directory. (Steps per wiki: “Building and Starting NetAnim”.)

### 5.5 Launch NetAnim and open your XML

```bash
./NetAnim
```

* In the GUI, **File → Open**, select your file from the repo:
  `Lab-00-Introduction/submission/lab0_cpp_anim.xml`
* Then scrub the timeline, verify nodes/packets, and **take a screenshot** for your submission.

---

## 6) Troubleshooting (fast)

* **`No module named 'ns.core'`**
  You used pybindgen-era import. Use `from ns import ns`. Source the env again:

  ```bash
  source scripts/setup_env.sh
  ```
- **Python scheduling errors with cppyy (Template method resolution failed)**  
Don’t pass raw Python callables to `Simulator.Schedule`. Either use the provided Lab-00 Python file (already adapted), or schedule a C++ shim event via `MakeEvent` (the standard pattern). The official docs describe NetAnim usage and `AnimationInterface`; Python semantics are cppyy-specific since ns-3.37+.

- **Where’s my XML?**  
You ran from `$NS3_DIR`; the output landed there. Rerun with an absolute `--animFile=/work/...` path, or move it afterward.

- **NetAnim won’t build**  
Make sure you installed Qt5 dev tools and used `qmake NetAnim.pro` before `make`. (This is exactly what the wiki prescribes.)

---